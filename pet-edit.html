<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>寵物資訊 - 編輯模式</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        /* --- 100% 保留原始樣式，一個都不少 --- */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            background-color: #f0f0f0; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            font-family: "Microsoft JhengHei", sans-serif; 
        }
        .phone-window { 
            width: 452px; 
            height: 968px; 
            background: linear-gradient(180deg, #FFE7C7 5.08%, #FFFFFF 23.64%); 
            position: relative; 
            overflow-y: auto; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.2); 
        }
        header { 
            padding: 60px 25px 30px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        .back-btn, .save-btn { 
            width: 43px; 
            height: 43px; 
            border: 1.5px solid #000000; 
            background: transparent; 
            border-radius: 50%; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            font-size: 20px; 
            color: #000; 
            cursor: pointer; 
            text-decoration: none; 
        }
        .page-title { 
            font-size: 32px; 
            font-weight: bold; 
            color: #000; 
        }
        .content-card { 
            width: 402px; 
            margin: 0 auto; 
            background: #FFF1DC; 
            border-radius: 15px; 
            padding: 16px; 
        }
        .pet-photo-container { 
            width: 100%; 
            height: 190px; 
            border-radius: 12px; 
            overflow: hidden; 
            margin-bottom: 20px; 
        }
        .pet-photo-container img { 
            width: 100%; 
            height: 100%; 
            object-fit: cover; 
        }
        .input-group { 
            margin-bottom: 15px; 
        }
        .input-group label { 
            display: block; 
            font-size: 18px; 
            font-weight: 600; 
            color: #333; 
            margin-bottom: 8px; 
        }
        .input-group input { 
            width: 100%; 
            height: 44px; 
            background: #FEF9F0; 
            border: none; 
            border-radius: 10px; 
            padding: 0 15px; 
            font-size: 16px; 
            color: #555; 
            outline: none; 
        }
        
        /* 按鈕區塊 */
        .footer-action { 
            width: 100%; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            gap: 15px; 
            margin-top: 30px; 
            padding-bottom: 40px; 
        }
        .submit-btn { 
            width: 402px; 
            height: 52px; 
            background: #FFAD4D; 
            border: none; 
            border-radius: 10px; 
            color: white; 
            font-size: 20px; 
            font-weight: bold; 
            cursor: pointer; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
        }
        
        /* 刪除按鈕樣式 */
        .delete-btn { 
            width: 402px; 
            height: 52px; 
            background: transparent; 
            border: 1.5px solid #FF5252; 
            border-radius: 10px; 
            color: #FF5252; 
            font-size: 18px; 
            font-weight: bold; 
            cursor: pointer; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
        }
        .delete-btn:hover { 
            background: #FF5252; 
            color: white; 
        }
    </style>
</head>
<body>
    <div class="phone-window">
        <header>
            <a href="javascript:history.back()" class="back-btn"><i class="fa-solid fa-chevron-left"></i></a>
            <div class="page-title" id="editTitle">編輯檔案</div>
            <button class="save-btn" onclick="saveData()"><i class="fa-solid fa-floppy-disk"></i></button>
        </header>

        <div class="content-card">
            <div class="pet-photo-container"><img src="sample/pet-info.png" alt="寵物照片"></div>
            <div class="input-group"><label>寵物名稱</label><input type="text" id="in_name"></div>
            <div class="input-group"><label>寵物種類</label><input type="text" id="in_type"></div>
            <div class="input-group"><label>品種</label><input type="text" id="in_breed"></div>
            <div class="input-group"><label>性別</label><input type="text" id="in_gender"></div>
            <div class="input-group"><label>生日</label><input type="text" id="in_birthday" placeholder="YYYY / MM / DD"></div>
            <div class="input-group"><label>備註</label><input type="text" id="in_note"></div>
            <div class="input-group"><label>晶片號碼</label><input type="text" id="in_allergy"></div>
        </div>

        <div class="footer-action">
            <button class="submit-btn" onclick="saveData()">儲存修改</button>
            <button class="delete-btn" onclick="deletePetData()">刪除寵物資料</button>
        </div>
    </div>

    <script>
        const params = new URLSearchParams(window.location.search);
        const petId = params.get('name') || '魯夫';

        window.onload = function() {
            document.getElementById('editTitle').innerText = petId + '的檔案';
            const stored = JSON.parse(localStorage.getItem('petData_' + petId));
            if (stored) {
                document.getElementById('in_name').value = stored.name;
                document.getElementById('in_type').value = stored.type;
                document.getElementById('in_breed').value = stored.breed;
                document.getElementById('in_gender').value = stored.gender;
                document.getElementById('in_birthday').value = stored.birthday;
                document.getElementById('in_note').value = stored.note;
                document.getElementById('in_allergy').value = stored.allergy;
            } else {
                // 如果是預設寵物且未存過檔，顯示預設名稱
                document.getElementById('in_name').value = petId;
            }
        };

        function saveData() {
            const data = {
                name: document.getElementById('in_name').value,
                type: document.getElementById('in_type').value,
                breed: document.getElementById('in_breed').value,
                gender: document.getElementById('in_gender').value,
                birthday: document.getElementById('in_birthday').value,
                note: document.getElementById('in_note').value,
                allergy: document.getElementById('in_allergy').value
            };
            // 儲存資料並清除刪除標記 (萬一使用者又想重新使用同一個名字)
            localStorage.setItem('petData_' + petId, JSON.stringify(data));
            localStorage.removeItem('deleted_' + petId); 
            
            alert('儲存成功！');
            location.href = `pet-info.html?name=${encodeURIComponent(data.name)}`;
        }

        // 刪除邏輯：移除資料並標記為已刪除
        function deletePetData() {
            if (confirm(`確定要永久刪除「${petId}」的資料嗎？`)) {
                // 1. 移除寵物詳細資料
                localStorage.removeItem('petData_' + petId);
                
                // 2. 設定刪除標記，供 my-pets.html 隱藏卡片使用
                localStorage.setItem('deleted_' + petId, 'true');
                
                alert('資料已刪除');
                location.href = 'my-pets.html';
            }
        }
    </script>
</body>
</html>
